<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Article aléatoire - Terre & Nature</title>
  <script>
    async function redirectToRandomArticle() {
      const msg = document.getElementById("message");
      try {
        msg.innerText = "Chargement du sitemap...";
        const response = await fetch('https://api.allorigins.win/raw?url=https://terrenature.ch/news-sitemap.xml');
        if (!response.ok) throw new Error("Erreur réseau : " + response.status);
        
        const text = await response.text();
        msg.innerText = "Analyse des articles...";
        
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, 'text/xml');
        const locElements = xml.getElementsByTagName('loc');
        const urls = Array.from(locElements).map(e => e.textContent);

        if (urls.length === 0) throw new Error("Aucun article trouvé !");
        
        const randomUrl = urls[Math.floor(Math.random() * urls.length)];
        msg.innerText = "Redirection vers : " + randomUrl;
        window.location.href = randomUrl;
      } catch (error) {
        msg.innerHTML = `<strong>Erreur :</strong> ${error.message}`;
        console.error(error);
      }
    }

    window.onload = redirectToRandomArticle;
  </script>
</head>
<body>
  <p id="message" style="font-size:18px; text-align:center; margin-top: 20%;">Initialisation...</p>
</body>
</html>
